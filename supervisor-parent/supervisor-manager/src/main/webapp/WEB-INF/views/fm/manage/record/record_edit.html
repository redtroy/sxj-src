<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- InstanceBegin template="/Templates/menu-list.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- InstanceBeginEditable name="doctitle" -->
<title>私享家电子商贸平台</title>
<link href="${b.staticPath}style/style.css" rel="stylesheet"
	type="text/css" />
<script src="${b.staticPath}js/jquery.js"></script>
<script src="${b.staticPath}js/jquery.paginate.js"></script>
<link href="${b.staticPath}style/jquery.iviewer.css" rel="stylesheet"
	type="text/css" />
<link rel="stylesheet" type="text/css" href="${b.staticPath}style/elastislide.css" />
<script src="${b.staticPath}js/jqueryui.js"></script>
<script src="${b.staticPath}js/intense.js"></script>
<script src="${b.staticPath}js/jquery.iviewer.js" type="text/javascript"></script>
<script src="${b.staticPath}js/jquery.bigautocomplete.js"></script>
<script src="${b.staticPath}js/jquery.paginate.js"></script>
<script src="${b.staticPath}js/jquery.mousewheel.js" type="text/javascript" ></script>
	<script src="${b.staticPath}js/jquery.elastislide-style.js" type="text/javascript" ></script>
	<script src="${b.staticPath}js/jquery.elastislide.js" type="text/javascript"></script>
	

<script>
	jQuery(document).ready(function($) {
		$('.demo-image').click(function() {
			$('.maskdivgen').fadeIn(100);
			$('.viewer').slideDown(200);
		})
		$('.modal-header .close').click(function() {
			$('.maskdivgen').fadeOut(100);
			$('.viewer').slideUp(200);
		})
	})
</script>
<@b.upload/> <@b.validate/>
<script type="text/javascript">
	function edit() {
		$("#record_save").submit();
	}
	$(function() {
		$("#record_save").Validform({
			tiptype : 3
		});
	})
	/*
	 $(document).ready(function() { 
	 loadUpload("img_path","${basePath}upload.htm",false,"上传合同扫描件",uploadLicense);
	 }); 
	 */
	$(document)
			.ready(
					function() {
						
						$(":file")
								.uploadify(
										{
											swf : '${basePath}upload/uploadify.swf',
											uploader : "${basePath}upload.htm",
											fileTypeExts : '*.gif; *.jpg; *.png',
											auto : true,
											multi : true,
											height : 30,
											width : 120,
											buttonText : '上传合同扫描件',
											onUploadSuccess : function(file,
													data, response) {
												var num = 0;
												var dataObj = eval("(" + data+ ")");//转换为json对象 
												var hideVal = $("#imgPath").val();
												if (hideVal == '') {
													hideVal = dataObj.fileIds;
												} else {
													hideVal += ","
															+ dataObj.fileIds;
													num=hideVal.split(",").length;
												}
												$("#carousel").append('<li><a href="javascript:void(0);" class="demo-image" data-image="${b.imagePath}'+dataObj.fileIds+'"><img src="${b.imagePath}'+dataObj.fileIds+'80x100.JPG" alt="" /></a><p>'+num+'</p></li>');

												$("#imgPath").val(hideVal);
												$( '.elastislide-list1' ).elastislide({
													orientation : 'horizontal',
													speed : 500,
													easing : 'ease-in-out',
													minItems : 3,
													start : 0,
													onClick : function( el, position, evt ) { 
														var imageSource = el.find("a").attr("data-image");
														$("#viewer2").iviewer({
															src : imageSource,
															mousewheel : true
														});
														el.parent().children("li").removeClass("view");
														el.addClass("view");
														$("#viewer2").children("img").attr("src",imageSource);
														$(".viewer").show();
														$(".modal-header").show();
														$(".maskdivgen").show();
														return false; 
													},
													onReady : function() { return false; },
													onBeforeSlide : function() { return false; },
													onAfterSlide : function() { return false; }
												});
											}
										});
					});
	$(document).ready(function() {
		var imgPath = $("#imgPath").val();
		$.ajaxSetup ({     
		    cache: false 
		}); 
		$.post("${basePath}filesort.htm",{fileId:imgPath},function(imgPaths){
			var j =0;
			for (var i = 0; i < imgPaths.length; i++) {
				j=i+1;
				$("#carousel").append('<li><a href="javascript:void(0);" class="demo-image" data-image="${b.imagePath}'+imgPaths[i]+'"><img src="${b.imagePath}'+imgPaths[i]+'80x100.JPG" alt="" /></a><p>'+j+'</p></li>');
			}
			
			$( '.elastislide-list' ).elastislide({
				orientation : 'horizontal',
				speed : 500,
				easing : 'ease-in-out',
				minItems : 3,
				start : 0,
				onClick : function( el, position, evt ) { 
					var imageSource = el.find("a").attr("data-image");
					$("#viewer2").iviewer({
						src : imageSource,
						mousewheel : true,
						onDelete:function(e){
							var imgurl =$(this).children("img").attr("src");
							var imgarr=imgurl.split("file-web/");
							var delImg =$("#imgPath").val();
							delImg=delImg.replace(new RegExp(imgarr[1]),'');
							$("#imgPath").val(delImg);
							//var delImgPath =$("#delImgPath").val();
							//if(delImgPath==''){
							//	$("#delImgPath").val(imgarr[1]);
							//}else{
							//	$("#delImgPath").val(delImgPath+","+imgarr[1]);
							//}
							$('.maskdivgen').fadeOut(100);
							$('.viewer').slideUp(200);
							el.remove();
						  }
					});
					el.parent().children("li").removeClass("view");
					el.addClass("view");
					$("#viewer2").children("img").attr("src",imageSource);
					$(".viewer").show();
					$(".modal-header").show();
					$(".maskdivgen").show();
					return false; 
				},
				onReady : function() { return false; },
				onBeforeSlide : function() { return false; },
				onAfterSlide : function() { return false; }
			});
			
		});
	}); 
	
</script>
</head>
<body>
	<@b.header/>
	<div id="main" class="fence-wide">
		<!-- InstanceBeginEditable name="local" -->
		<@b.menuPath/>
		<!-- InstanceEndEditable -->
		<div id="mainBg" class="ly-clearFix yard-1200">
			<div id="leftList"><@b.leftMenu /></div>
			<div id="rightBar">
				<!-- InstanceBeginEditable name="rightBar" -->
				<h2 class="title">备案修改</h2>
				<div class="infoBox binBox f14">
					<ul>
						<form action="record_save.htm?id=${record.id}" method="post"
							id="record_save">
							<li><label>备案号</label>${record.recordNo}</li>
							<li><label>申请会员</label><input type="text"
								value="${record.applyName}" id="applyName" name="applyName"
								datatype="*2-50" nullmsg="请输入会员名称" /></li>
							<li><label>甲方名称</label><input type="text"
								value="${record.memberNameA}" id="memberNameA"
								name="memberNameA" datatype="*2-50" nullmsg="请输入甲方名称" /></li>
							<li><label>乙方名称</label><input type="text"
								value="${record.memberNameB}" id="memberNameB"
								name="memberNameB" datatype="*2-50" nullmsg="请输入乙方名称" /></li>
							<li><label>合同类型</label><select id="contractType"
								name="contractType"> <#list cte as type> <#if
									(type.id=record.contractType.id)>
									<option selected="selected" value="${type.id}">${type.getName()}</option>
									<#else>
									<option value="${type.id}">${type.getName()}</option> </#if>
									</#list>
							</select></li>
							<li class="contPic ly-clearFix"><label>备案扫描件</label> <!--  <span class="ly-left"><button id="img_path" class="button button-green button-middle"></button><input type="hidden" id="imgPath" name="imgPath"></span>-->
									<input type="hidden" value="${record.imgPath}" name="imgPath" id="imgPath" />
									<input type="hidden" value="" name="delImgPath" id="delImgPath" />
									<div class="rollBox">
										<ul id="carousel" class="elastislide-list"></ul>
									</div>
									</li>
									<li class="ly-clearFix"><label class="ly-left">&nbsp;</label>
								
								<span class="ly-left"> 
									 <input type="file" name="contractFile" id="contractFile" multiple="true" />
							</span></li>
							<li><label>关联招标合同</label><input type="text"
								value="${record.refContractNo}" name="refContractNo"
								datatype="*2-50" nullmsg="请输入招标合同" /></li>
							<li><label>备案类型</label><select id="type" name="type">
									<#list rte as type> <#if (type.id=record.type.id)>
									<option selected="selected" value="${type.id}">${type.getName()}</option>
									<#else>
									<option value="${type.id}">${type.getName()}</option> </#if>
									</#list>
							</select></li>
							<li><label>申请备案时间</label> <#if (record.applyDate??)>
								${record.applyDate?date}</li> </#if>
							<li><label>受理时间</label> <#if (record.acceptDate??)>
								${record.acceptDate?date}</li> </#if>
					</ul>
					</form>
					<div class="btnBox">
						<a href="#" class="button button-orange button-small"
							onclick="edit()">修改</a> <a href="javascript:history.go(-1);"
							class="button button-gray button-small">返回</a>
					</div>
				</div>
				<!-- InstanceEndEditable -->
			</div>
		</div>
	</div>
	
	<@b.footer />
	<div class="viewer modal-wrap" style="display: none">
									<div class="modal-header">
										<span class="close">关闭</span>
									</div>
									<div id="viewer2" class="modal-body"></div>
								</div>
	<div class="maskdivgen" style="display: none"></div> 
</body>
<!-- InstanceEnd -->
</html>
