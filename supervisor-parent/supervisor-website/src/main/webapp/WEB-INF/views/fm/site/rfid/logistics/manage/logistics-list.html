<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>ç§äº«å®¶ç»¿è‰²é—¨çª—å¹³å/title>
<meta name="keywords" content="ç§äº«å®¶ç»¿è‰²é—¨çª—å¹³åé—¨çª—,å‹æåç»ç’ƒåé—¨çª—"/>
<meta name="description" content="ç§äº«å®¶ç»¿è‰²é—¨çª—å¹³åä¸ºé—¨çª—è¡Œä¸šçš„ç»ç’ƒåå‹æå‚æä¾›äº§å“ç›˜ç‚ç‰©æµè·Ÿè¸ª,è´¨é‡æº¯æºæœåŠ¡ã€‚è‡´åŠ›äºæ¨åŠ¨æ±Ÿè‹çœæˆ¿åœ°äº§å»ºç­‘è¡Œä¸šç»¿è‰²ç¯ä¿äº‹ä¸šã€>
<link href="${b.staticPath}style/style.css" rel="stylesheet" type="text/css" />
<script src="${b.staticPath}js/jquery.js"></script>
<@b.pageScript/>
<@b.errorInfo/>
<!-- ä¾›åº”é“¾ç‰©æµç®¡ç-->
<script >

function query(page){
	var params=$("#search_form").serialize();
	 if(page!=undefined){
		   params=params+"&currentPage="+page;
	   }
	$.post("queryList.htm",params,function(data){
		var res=$(data).find(".tabList");
		var pager=$(data).find("#pager");
		$(".tabList").empty();
		$(".tabList").append(res.html());
		var totalPage=pager.attr("totalPage");
		var currentPage=pager.attr("currentPage");
		loadPage(currentPage,totalPage,query);
	});
}
function  del(id){
	if(confirm('ç¡®å®è¦åˆ é™¤å—?')){
	$.post("delete.htm",{id:id},function(data){
		if(data.isOK=='ok'){
			succInfo(function(){
				window.location.href="query.htm";
			},"åˆ é™¤æˆåŠŸ!");
			
		}else{
			errorInfo("åˆ é™¤å¤±è´¥!");	
		}
	});
	}
}
function  disable(id){
	if(confirm('ç¡®å®è¦åœç”¨å—?')){
	$.post("disable.htm",{id:id},function(data){
		if(data.isOK=='ok'){
			succInfo(function(){
				window.location.href="query.htm";
			},"åœç”¨æˆåŠŸ!");
			
		}else{
			messageInfo("åœç”¨å¤±è´¥!");	
		}
	});
	}
}
function loadInfo(id,rfidNo,contractNo){
	if ($("#info"+id).html()==""){
		$("#info"+id).load("${basePath}/rfid/window/contractBatch.htm?contractNo="+contractNo+"&rfidNo="+rfidNo+"&id="+id);
		$("#log"+id).html("");
	}else{
		close(id);
	}
	
}

function loadContractInfo(id,contractNo){
	if ($("#info"+id).html()==""){
		$("#info"+id).load("${basePath}record/info.htm?contractNo="+contractNo);
		$("#log"+id).html("");
	}else{
		close(id);
	}
}
function close(id){
	$("#info"+id).html("");
}

function log(id){
	$("#info"+id).load("stateLog.htm?id="+id);
}
function closeLog(id){
	$("#info"+id).html("");
}
</script>
</head>

<body>
<div id="header" class="fence">
<@b.header /> 
</div>
<div class="mainBg">
<div class="fence-wide ly-clearFix">
<div class="main pb20">
<div class="yard-190 ly-left leftMenu">
<@b.leftMenu />
</div>
<div class="yard-870 rightSide ly-left">
<div class="heading mb15 ly-clearFix">
  <h1 class="ly-left">
  <span class="title fontYH f20 fb">ç‰©æµæ ‡ç­¾ç®¡ç†</span></h1>
</div>
<div class="contBox f12">
<form action="javascript:void(0);" method="post" id="search_form">
<div class="searBox mb10">
  æ ‡ç­¾ç¼–å·<input type="text" name="rfidNo" value="${query.rfidNo}"/>
  ç”³è¯·å•å·<input type="text" name="applyNo" value="${query.applyNo}"/>
  é‡‡è´­åˆåŒåinput type="text" name="contractNo" value="${query.contractNo}"/>
  æ ‡ç­¾è¿›åº¦<select name="progressState" class="selectx">
          <option value="" selected="selected">å…¨éƒ¨</option>
		  <#list Label as label> 
           <#if (label.id==0)>
		    <option value="${label.getId()}">æ ‡ç­¾å‘è´§ä¸/option>
		    <#elseif (label.id>1)>
            <option value="${label.getId()}">${label.getName()}</option>
            </#if>
          </#list>
        </select>
  æ ‡ç­¾çŠ¶æ€<select name="rfidState">
		<option value="" selected="selected">å…¨éƒ¨</option>
           <#list rfid as rfid>
           <#if !rfid_has_next>
           <#break>
           </#if>
          <option value="${rfid.getId()}">${rfid.getName()}</option>
          </#list>
        </select><button class="button button-search" onclick="query();return false;">æŸ¥è¯¢</button>
</div>
</form>
   <@b.pager/>
  <table border="0" cellpadding="0" cellspacing="0" class="tabList" id="res_table">
  <col width="12%">
<col width="12%">
<col width="11%">
<col width="11%">
<col width="11%">
<col width="14%">
<col width="12%">
<col width="18%">
    <tr>
      <th>æ ‡ç­¾ç¼–å·</th>
      <th>ç”³è¯·å•å·</th>
      <th>é‡‡è´­åˆåŒå/th>
      <th>æ‰§è¡Œæ‰¹æ¬¡</th>
      <th>è¡¥æŸæ ‡ç­¾</th>
	  <th>æ ‡ç­¾è¿›åº¦</th>
	  <th >æ ‡ç­¾çŠ¶æ€/th>
	   <th class="rLine">æ“ä½œ</th>
      </tr>
       <#list list as list>
        <tr>
          <td><a href="javascript:log('${list.id}');" class="lnk-blue">${list.rfidNo}</a></td>
          <td>${list.applyNo}</td>
          <td><a href="javascript:loadContractInfo('${list.id}','${list.contractNo}')" class="lnk-blue">${list.contractNo}</a></td>
		  <td><a href="javascript:loadInfo('${list.id}','${list.rfidNo}','${list.contractNo}')" class="lnk-blue">${list.batchNo}</a></td>
          <td><#if list.replenishNo?exists>${list.replenishNo}<#else>-</#if></td>
		   <#if (list.progressState.getId()==0)>
		  <td><em class="state frozen">æ ‡ç­¾å‘è´§ä¸/em></td>
		  <#elseif ((list.progressState.getId()==1))>
		  <td><em class="state frozen">æ ‡ç­¾å‘è´§ä¸/em></td>
		  <#elseif ((list.progressState.getId()==2))>
		  <td><em class="state process">${list.progressState.getName()}</em></td>
		  <#elseif ((list.progressState.getId()==3))>
		  <td><em class="state normal">${list.progressState.getName()}</em></td>
		  <#elseif ((list.progressState.getId()==4))>
		  <td><em class="state verified">${list.progressState.getName()}</em></td>
		  </#if>
		  <td> <#if list.rfidState.getId()==0>
		  <em class="state normal">${list.rfidState.getName()}</em>
		  </#if>
		   <#if list.rfidState.getId()==1>
		   <em class="state verified">${list.rfidState.getName()}</em>
		  </#if>
		   <#if list.rfidState.getId()==2>
		   <em class="state frozen">${list.rfidState.getName()}</em>
		  </#if>
		   <#if list.rfidState.getId()==3>
		   <em class="state frozen">${list.rfidState.getName()}</em>
		  </#if></td>
		  <td><#if list.rfidState.getId()==0><a href="to_start.htm?id=${list.id}" class="lnk-blue" title=""><span class="icon icon16 icon-ok"></span>å¯ç”¨</a> &nbsp;&nbsp;<a href="to_loss.htm?rfidNo=${list.rfidNo}" class="lnk-blue" title=""><span class="icon icon16 icon-relat"></span>è¡¥æŸ</a></#if></td>
        </tr>
        <tr class="tableInfo" id="info${list.id}"> </tr>
        <tr id="log${list.id}"> </tr>
        </#list>
  </table>
</div>
</div>
</div>
</div>
<@b.footer />
</body>
</html>
